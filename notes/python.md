#### 1、python的gc垃圾回收

- **1.1 机制**：

  - **引用计数**（主）

    对象引用计数变为0，用户不可能通过任何方式使用这个对象，当垃圾回收启动时，Python扫描到这个引用计数为0的对象，就将它所占用的内存进行回收。

  - **标记清除**（辅）

    A）标记阶段，遍历所有的对象，如果是可达的（reachable），也就是还有对象引用它，那么就标记该对象为可达；

    B）清除阶段，再次遍历对象，如果发现某个对象没有标记为可达，则就将其回收。

  - **分代回收**（辅）

- **1.2 时机**

  - **自动回收**：当gc模块的计数器达到阀值的时候，触发自动回收
  - **手动回收**：使用gc模块中的collect 方法
  - **程序退出**

参考

[Python垃圾回收机制](https://zhuanlan.zhihu.com/p/83251959)

[记一次面试问题——Python 垃圾回收机制](https://testerhome.com/topics/16556)

#### 2、闭包

```python
def outer(a):
  def inner(b):
    print(a+b)
  return inner

test = outer(1)
test(2)
test(3)
```

在计算机科学中，闭包（英语：Closure），又称词法闭包（Lexical Closure）或函数闭包（function closures），是引用了**自由变量**的函数。**这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外**。所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。

**自由变量**：如果变量在一个代码块中被使用但不是在其中定义，则为 *自由变量*。

闭包在运行时可以有多个实例，不同的引用环境和相同的函数组合可以产生不同的实例。			

**归纳一下，闭包必须满足的三个条件：**

1、需要有一个内嵌函数（也就是上面例子中的inner函数）

2、内嵌函数需要引用定义在外部函数中的变量（自由变量）

3、内嵌函数需要被返回（这一点最重要，是区别普通嵌套函数与闭包的本质）

闭包用处：

有了闭包，我们可以不使用全局变量，要知道，在任何一门语言中，全局变量都是被谨慎使用了，稍不注意，就会出问题。

还有一个很大的用处，把一些数据和函数联系起来，这大大简化了代码，也提升了可读性

[理解Python闭包概念](https://www.cnblogs.com/yssjun/p/9887239.html)

[python玄学系列(第二集)：这大概是最全面最通俗易懂的python闭包了](https://zhuanlan.zhihu.com/p/102462850)

[python装饰器的原理和使用](https://segmentfault.com/a/1190000019506549)

#### 3、协程

协程是一种用户态的轻量级线程，即协程是由**用户程序**自己**控制调度**的。不是操作系统控制

总结协程的特点：

1. **必须在只有一个单线程里实现并发**
2. **修改共享数据不需加锁**
3. **用户程序里自己保存多个控制流的上下文栈**
4. **附加：一个协程遇到IO操作自动切换到其它协程（如何实现检测IO，yield、greenlet都无法实现，就用到了gevent模块（select机制））**

[Python之协程](https://www.cnblogs.com/russellyoung/p/python-zhi-xie-cheng.html)

[协程（维基）](https://zh.wikipedia.org/wiki/%E5%8D%8F%E7%A8%8B)

[Python 3.5 协程原理](https://juejin.im/entry/6844903428229955597)