#### 说一下mysql索引

#### B+树索引特点
B+树索引特点：
1. **树高**: 一般来说，树的高度要比二叉平衡树低很多

2. **数组**: 每一个node，都是一个“数组”，数组是很关键的决定性因素，因为**顺序数组**可以进行**二分查找**。

3. **数据**：只出现在**叶子**节点，非叶子结点只存放指针，这样非叶子结点就可以存放更多指针，相对于B树，B+树高又可以进一步降低。**这里的数据不一定是行数据，只有聚集索引才存放行数据，如果行数据有text类型的话，行数据会放到BLOB页中**。

4. **顺序指针**：所有叶子节点增加了一个双向链表指针，这样有利于进行范围查找，因为只需要遍历链表即可。

5、**平衡**：B+树在插入和删除的过程中可以保持树的平衡性。

#### B+树与B树区别？
见《数据库系统概论》P286 11.4.5
- B+树只有叶子节点带有指向记录的指针，B树叶子节点和非叶子节点都有指向记录的指针
- B树非叶子节点有指向桶或者文件记录的指针，所以单个非叶子节点容纳更少的索引项，也就是**扇出**没有B+树大，导致高度比B+树高，查询时间不稳定
- B+树所有叶子节点之前有双向链表指针相连，可以进行范围查找。
- B树的删除更加复杂

B+树的优点：

1. 非叶子节点不会带上ROWID，这样，一个块中可以容纳更多的索引项，一是可以降低树的高度。二是一个内部节点可以定位更多的叶子节点。

2. 叶子节点之间通过指针来连接，范围扫描将十分简单，而对于B树来说，则需要在叶子节点和内部节点不停的往返移动。

B树的优点：

对于在内部节点的数据，可直接得到，不必根据叶子节点来定位。**但是意义不是很大，因为叶子节点数量占了一大半，所以大部分查询还是查到叶子节点上，而叶子节点高度比B+树高**。

#### mysql的B+树索引查找的时间复杂度为多少?

我们知道IO次数取决于b+数的高度h，假设当前数据表的数据(**准确来说应该是搜索码，搜索码比数据多，数据只在最后一层叶子节点**)为N，每个磁盘块的数据项的数量是m，则有h=㏒(m+1)N，当数据量N一定的情况下，m越大，h越小；而m = 磁盘块的大小 /  数据项的大小，磁盘块的大小也就是一个数据页的大小，是固定的，如果数据项占的空间越小，数据项的数量越多，树的高度越低。这就是为什么每个数据项，即索引字段要尽量的小，比如int占4字节，要比bigint8字节少一半。这也是为什么b+树要求把真实的数据放到叶子节点而不是内层`节点，一旦放到内层节点，磁盘块的数据项会大幅度下降，导致树增高。当数据项等于1时将会退化成线性表。

[MySQL索引原理及慢查询优化](https://tech.meituan.com/2014/06/30/mysql-index.html)

[关于B+树的时间复杂度分析](https://blog.csdn.net/wufeifan_learner/article/details/109724836)

《数据库系统概念》B+树的查找 P276

#### B+树的叶子节点是否存放行数据？
B+树的叶子节点和非叶子节点结构相同
《数据库系统概念》P274
只有聚集索引的叶子节点才存放行数据，辅助索引不存放，辅助索引存放主键，不过覆盖索引可以存放部分列数据
《Mysql技术内幕》P142 5.4.1

#### innodb引擎的B+树叶子节点满了后会进行分裂吗？
不一定，如果左右叶子节点未满的话，可以进行**旋转**，将记录迁移到所在页的兄弟节点上。
《Mysql技术内幕》P189 5.3.1B+树的插入操作

#### B+树的叶子节点是物理连续的吗？
不一定，B+树叶子节点在磁盘空间不一定是**物理连续**的，它们是**逻辑连续**的，B+树刚生成的时候是物理连续的，随着插入和删除的不断进行，慢慢就不是物理连续的，所以为了恢复这种连续，需要对索引进行**重建**。
#### 聚集索引在物理上是连续的吗？
不是，是逻辑上连续的 《mysql技术内幕》P194 5.4.1

#### mysql聚簇索引数据一定会放在叶子节点上吗？如果行里面有text类型数据，数据量很大，数据会放在哪里？
会放在BLOB页中，原来的B+树的数据页节点存放的是前缀数据和偏移量
《Mysql技术内幕》P110 4.3.3行溢出数据
